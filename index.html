<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora ARICAS - Multi Bombeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen flex flex-col items-center pb-10 bg-gray-900 text-white">

<header class="w-full bg-red-700 p-4 shadow-lg flex items-center justify-center gap-3">
    <i data-lucide="flame" class="text-yellow-400 w-8 h-8"></i>
    <h1 class="text-2xl font-bold tracking-wider text-white">ARICAS CBSLeiria</h1>
</header>

<!-- TABS DOS 6 BOMBEIROS -->
<div class="w-full max-w-md mt-4 px-4 flex justify-between gap-1">
    <script>
    function highlightTabs() {
        for (let i = 1; i <= 6; i++) {
            const f = FF[i];
            const useful = Math.max(0, f.pressure - 50) * f.volume;
            const minutes = Math.floor(useful / f.consumption);
            const tab = document.getElementById(`tab-${i}`);

            if (!tab) continue;

            if (minutes <= 5) {
                tab.classList.add("animate-pulse", "bg-red-800");
            } else {
                tab.classList.remove("animate-pulse", "bg-red-800");
            }
        }
    }
        document.write([1,2,3,4,5,6].map(i => `
            <button id="tab-${i}" onclick="selectFF(${i})"
                class='flex-1 py-2 rounded bg-gray-700 text-white text-sm font-bold'>B${i}</button>
        `).join(""));
    </script>
</div>

<!-- ÁREA DO CONTEÚDO ORIGINAL -->
<main id="content" class="w-full max-w-md px-4 mt-6 space-y-6"></main>

<script>
    lucide.createIcons();

    // Criar estado para 6 bombeiros
    const FF = {};
    for (let i = 1; i <= 6; i++) {
        FF[i] = {
            name: "",
            volume: 6.8,
            consumption: 45,
            pressure: 300,
            entry: "--:--",
            exit: "--:--"
        };
    }

    let active = 1;

    function selectFF(id) {
        active = id;
        render();

    // Atualização automática a cada minuto
    setInterval(() => {
        // Recalcular tempos
        for (let i = 1; i <= 6; i++) {
            const f = FF[i];
            if (f.entry !== "--:--") {
                // Atualiza saída com base no tempo restante
                const useful = Math.max(0, f.pressure - 50) * f.volume;
                const minutes = Math.floor(useful / f.consumption);

                const now = new Date();
                const exit = new Date(now.getTime() + minutes * 60000);
                f.exit = exit.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
            }
        }
        highlightTabs();
        if (active) calculate();
    }, 60000);
    }

    function render() {
        highlightTabs();
        // Atualizar estilo das tabs
        for (let i = 1; i <= 6; i++) {
            const t = document.getElementById(`tab-${i}`);
            if (i === active) t.className = "flex-1 py-2 rounded bg-red-600 border-2 border-white text-white font-bold";
            else t.className = "flex-1 py-2 rounded bg-gray-700 text-white font-bold";
        }

        const f = FF[active];

        document.getElementById("content").innerHTML = `
            <section class='bg-gray-800 p-4 rounded-xl border border-gray-700'>
                <label class='block text-gray-400 text-sm mb-1'>Nome do Bombeiro</label>
                <input type='text' value='${f.name}' onchange='FF[active].name = this.value'
                       class='w-full bg-gray-900 p-2 rounded border border-gray-700'>
            </section>

            ${originalHTML()}
        `;

        lucide.createIcons();
        restoreValues();
    }

    /* Função que devolve o HTML original (SEM alterações!) */
    function originalHTML() {
        return `
        <section class='bg-gray-800 rounded-xl p-5 border border-gray-700'>
            <label class='block text-gray-400 text-sm font-bold mb-3 uppercase'>1. Volume da Garrafa</label>
            <div class='grid grid-cols-3 gap-2'>
                <button onclick="setVolume(6)" id="vol-6" class="vol-btn bg-gray-700 py-3 rounded-lg font-bold">6 L</button>
                <button onclick="setVolume(6.8)" id="vol-6.8" class="vol-btn bg-gray-700 py-3 rounded-lg font-bold">6.8 L</button>
                <button onclick="setVolume(9)" id="vol-9" class="vol-btn bg-gray-700 py-3 rounded-lg font-bold">9 L</button>
            </div>
        </section>

        <section class='bg-gray-800 rounded-xl p-5 border border-gray-700'>
            <label class='block text-gray-400 text-sm font-bold mb-3 uppercase'>2. Ritmo de Trabalho</label>
            <div class='grid grid-cols-2 gap-2'>
                <button onclick="setConsumption(40)" id="cons-40" class="cons-btn bg-gray-700 py-3 rounded-lg font-bold text-sm">Moderado<br><span class='text-xs'>40 L/min</span></button>
                <button onclick="setConsumption(45)" id="cons-45" class="cons-btn bg-gray-700 py-3 rounded-lg font-bold text-sm">Intenso<br><span class='text-xs'>45 L/min</span></button>
            </div>
        </section>

        <section class="bg-gray-800 rounded-xl p-5 border border-gray-700">
            <label class="block text-gray-400 text-sm font-bold mb-3 uppercase">3. Pressão Atual (Bar)</label>
            <input id="pressure" type="number" class="w-full bg-gray-900 text-center text-4xl font-bold border border-gray-600 rounded-lg py-2" onchange="updatePressure()">
        </section>

        <section class='bg-gray-900 p-6 rounded-xl border border-gray-700 text-center'>
            <p class='text-gray-400 text-sm uppercase mb-1'>Tempo Disponível</p>
            <p id='result-minutes' class='text-7xl font-bold'>00</p>
        </section>

        <section class='bg-blue-900/20 border border-blue-800/50 rounded-xl p-5'>
            <div class='flex justify-between mb-2'>
                <h3 class='text-blue-200 font-bold flex items-center gap-2'>Controlo de Entrada</h3>
                <button onclick='setEntry()' class='bg-blue-600 text-xs px-3 py-1 rounded'>Entrar Agora</button>
            </div>
            <div class='flex justify-between'>
                <div>
                    <p class='text-xs text-gray-400'>Entrada:</p>
                    <p id='entry-time' class='text-xl font-mono'>${FF[active].entry}</p>
                </div>
                <div class='text-right'>
                    <p class='text-xs text-gray-400'>Saída:</p>
                    <p id='exit-time' class='text-3xl font-mono'>${FF[active].exit}</p>
                </div>
            </div>
        </section>`;
    }

    function restoreValues() {
        const f = FF[active];

        // Pressão
        document.getElementById("pressure").value = f.pressure;

        // Volume buttons
        document.querySelectorAll('.vol-btn').forEach(btn => {
            btn.classList.remove("bg-red-600", "border-white", "text-white", "shadow-lg", "shadow-red-900/50");
            btn.classList.add("bg-gray-700");
        });
        const volBtn = document.getElementById(`vol-${f.volume}`);
        if (volBtn) {
            volBtn.classList.remove("bg-gray-700");
            volBtn.classList.add("bg-red-600", "border-white", "text-white", "shadow-lg", "shadow-red-900/50");
        }

        // Consumption buttons
        document.querySelectorAll('.cons-btn').forEach(btn => {
            btn.classList.remove("bg-red-600", "border-white", "text-white");
            btn.classList.add("bg-gray-700");
        });
        const consBtn = document.getElementById(`cons-${f.consumption}`);
        if (consBtn) {
            consBtn.classList.remove("bg-gray-700");
            consBtn.classList.add("bg-red-600", "border-white", "text-white");
        }

        calculate();
    }

    function setVolume(v) { FF[active].volume = v; calculate(); render(); }
    function setConsumption(c) { FF[active].consumption = c; calculate(); render(); }
    function updatePressure() { FF[active].pressure = parseInt(document.getElementById("pressure").value); calculate(); }

    function calculate() {
        const f = FF[active];
        const useful = Math.max(0, f.pressure - 50) * f.volume;
        const minutes = Math.floor(useful / f.consumption);
        document.getElementById("result-minutes").innerText = minutes;
    }

    function setEntry() {
        const f = FF[active];
        const now = new Date();
        const min = parseInt(document.getElementById("result-minutes").innerText);

        f.entry = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
        const exit = new Date(now.getTime() + min * 60000);
        f.exit = exit.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

        render();
    }

    render();
</script>

</body>
</html>
